<template>
  <tr>
    <td>
      <span
        class="icon has-text-primary"
        v-if="detail.ready"
        :title="t('orders.details.ready')"
        ><i class="fas fa-check"></i
      ></span>
      <span class="is-capitalized">{{ detail.product_name }}</span>
    </td>
    <td class="has-text-centered">
      <span>{{ detail.unit_name }}</span>
    </td>

    <td class="has-text-right hide-on-small">
      {{ n(parseFloat(detail.price || 0), "currency") }}
    </td>
    <td class="has-text-right">{{ detail.quantity }}</td>
    <td class="has-text-right">{{ n(detail.cost, "currency") }}</td>
    <!-- <td class="has-text-right">{{ detail.cost }}</td> -->
    <td class="has-text-centered has-text-info">
      <button
        :title="t('edit')"
        @click="toggleEdit"
        class="button is-small is-info has-text-weight-medium"
      >
        Sá»­a
      </button>
    </td>
  </tr>
  <OrderDetailModal
    v-if="showEdit"
    :title="t('orders.details.editTitle')"
    :detail="detail"
    @close="toggleEdit"
    @save="edit"
  />
</template>

<script>
import { ref } from "vue";
import { useStore } from "vuex";

import OrderDetailModal from "./OrderDetailModal.vue";

export default {
  components: { OrderDetailModal },
  props: ["detail"],
  inject: ["t", "n"],
  setup(props) {
    const showEdit = ref(false);
    const store = useStore();

    const toggleEdit = () => {
      showEdit.value = !showEdit.value;
    };

    const edit = async (payload) => {
      await store.dispatch("orders/editDetail", {
        id: props.detail.id,
        payload,
      });
      showEdit.value = false;
    };

    return { showEdit, toggleEdit, edit };
  },
};
</script>

<style scoped>
span.icon {
  cursor: pointer;
}

.v-align {
  vertical-align: middle;
}
</style>

